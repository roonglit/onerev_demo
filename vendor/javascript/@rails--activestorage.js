// @rails/activestorage@8.0.300 downloaded from https://ga.jspm.io/npm:@rails/activestorage@8.0.300/app/assets/javascripts/activestorage.esm.js

var t={exports:{}};(function(t){(function(e){t.exports=e()})((function(t){var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function r(t,e){var r=t[0],i=t[1],s=t[2],n=t[3];r+=(i&s|~i&n)+e[0]-680876936|0;r=(r<<7|r>>>25)+i|0;n+=(r&i|~r&s)+e[1]-389564586|0;n=(n<<12|n>>>20)+r|0;s+=(n&r|~n&i)+e[2]+606105819|0;s=(s<<17|s>>>15)+n|0;i+=(s&n|~s&r)+e[3]-1044525330|0;i=(i<<22|i>>>10)+s|0;r+=(i&s|~i&n)+e[4]-176418897|0;r=(r<<7|r>>>25)+i|0;n+=(r&i|~r&s)+e[5]+1200080426|0;n=(n<<12|n>>>20)+r|0;s+=(n&r|~n&i)+e[6]-1473231341|0;s=(s<<17|s>>>15)+n|0;i+=(s&n|~s&r)+e[7]-45705983|0;i=(i<<22|i>>>10)+s|0;r+=(i&s|~i&n)+e[8]+1770035416|0;r=(r<<7|r>>>25)+i|0;n+=(r&i|~r&s)+e[9]-1958414417|0;n=(n<<12|n>>>20)+r|0;s+=(n&r|~n&i)+e[10]-42063|0;s=(s<<17|s>>>15)+n|0;i+=(s&n|~s&r)+e[11]-1990404162|0;i=(i<<22|i>>>10)+s|0;r+=(i&s|~i&n)+e[12]+1804603682|0;r=(r<<7|r>>>25)+i|0;n+=(r&i|~r&s)+e[13]-40341101|0;n=(n<<12|n>>>20)+r|0;s+=(n&r|~n&i)+e[14]-1502002290|0;s=(s<<17|s>>>15)+n|0;i+=(s&n|~s&r)+e[15]+1236535329|0;i=(i<<22|i>>>10)+s|0;r+=(i&n|s&~n)+e[1]-165796510|0;r=(r<<5|r>>>27)+i|0;n+=(r&s|i&~s)+e[6]-1069501632|0;n=(n<<9|n>>>23)+r|0;s+=(n&i|r&~i)+e[11]+643717713|0;s=(s<<14|s>>>18)+n|0;i+=(s&r|n&~r)+e[0]-373897302|0;i=(i<<20|i>>>12)+s|0;r+=(i&n|s&~n)+e[5]-701558691|0;r=(r<<5|r>>>27)+i|0;n+=(r&s|i&~s)+e[10]+38016083|0;n=(n<<9|n>>>23)+r|0;s+=(n&i|r&~i)+e[15]-660478335|0;s=(s<<14|s>>>18)+n|0;i+=(s&r|n&~r)+e[4]-405537848|0;i=(i<<20|i>>>12)+s|0;r+=(i&n|s&~n)+e[9]+568446438|0;r=(r<<5|r>>>27)+i|0;n+=(r&s|i&~s)+e[14]-1019803690|0;n=(n<<9|n>>>23)+r|0;s+=(n&i|r&~i)+e[3]-187363961|0;s=(s<<14|s>>>18)+n|0;i+=(s&r|n&~r)+e[8]+1163531501|0;i=(i<<20|i>>>12)+s|0;r+=(i&n|s&~n)+e[13]-1444681467|0;r=(r<<5|r>>>27)+i|0;n+=(r&s|i&~s)+e[2]-51403784|0;n=(n<<9|n>>>23)+r|0;s+=(n&i|r&~i)+e[7]+1735328473|0;s=(s<<14|s>>>18)+n|0;i+=(s&r|n&~r)+e[12]-1926607734|0;i=(i<<20|i>>>12)+s|0;r+=(i^s^n)+e[5]-378558|0;r=(r<<4|r>>>28)+i|0;n+=(r^i^s)+e[8]-2022574463|0;n=(n<<11|n>>>21)+r|0;s+=(n^r^i)+e[11]+1839030562|0;s=(s<<16|s>>>16)+n|0;i+=(s^n^r)+e[14]-35309556|0;i=(i<<23|i>>>9)+s|0;r+=(i^s^n)+e[1]-1530992060|0;r=(r<<4|r>>>28)+i|0;n+=(r^i^s)+e[4]+1272893353|0;n=(n<<11|n>>>21)+r|0;s+=(n^r^i)+e[7]-155497632|0;s=(s<<16|s>>>16)+n|0;i+=(s^n^r)+e[10]-1094730640|0;i=(i<<23|i>>>9)+s|0;r+=(i^s^n)+e[13]+681279174|0;r=(r<<4|r>>>28)+i|0;n+=(r^i^s)+e[0]-358537222|0;n=(n<<11|n>>>21)+r|0;s+=(n^r^i)+e[3]-722521979|0;s=(s<<16|s>>>16)+n|0;i+=(s^n^r)+e[6]+76029189|0;i=(i<<23|i>>>9)+s|0;r+=(i^s^n)+e[9]-640364487|0;r=(r<<4|r>>>28)+i|0;n+=(r^i^s)+e[12]-421815835|0;n=(n<<11|n>>>21)+r|0;s+=(n^r^i)+e[15]+530742520|0;s=(s<<16|s>>>16)+n|0;i+=(s^n^r)+e[2]-995338651|0;i=(i<<23|i>>>9)+s|0;r+=(s^(i|~n))+e[0]-198630844|0;r=(r<<6|r>>>26)+i|0;n+=(i^(r|~s))+e[7]+1126891415|0;n=(n<<10|n>>>22)+r|0;s+=(r^(n|~i))+e[14]-1416354905|0;s=(s<<15|s>>>17)+n|0;i+=(n^(s|~r))+e[5]-57434055|0;i=(i<<21|i>>>11)+s|0;r+=(s^(i|~n))+e[12]+1700485571|0;r=(r<<6|r>>>26)+i|0;n+=(i^(r|~s))+e[3]-1894986606|0;n=(n<<10|n>>>22)+r|0;s+=(r^(n|~i))+e[10]-1051523|0;s=(s<<15|s>>>17)+n|0;i+=(n^(s|~r))+e[1]-2054922799|0;i=(i<<21|i>>>11)+s|0;r+=(s^(i|~n))+e[8]+1873313359|0;r=(r<<6|r>>>26)+i|0;n+=(i^(r|~s))+e[15]-30611744|0;n=(n<<10|n>>>22)+r|0;s+=(r^(n|~i))+e[6]-1560198380|0;s=(s<<15|s>>>17)+n|0;i+=(n^(s|~r))+e[13]+1309151649|0;i=(i<<21|i>>>11)+s|0;r+=(s^(i|~n))+e[4]-145523070|0;r=(r<<6|r>>>26)+i|0;n+=(i^(r|~s))+e[11]-1120210379|0;n=(n<<10|n>>>22)+r|0;s+=(r^(n|~i))+e[2]+718787259|0;s=(s<<15|s>>>17)+n|0;i+=(n^(s|~r))+e[9]-343485551|0;i=(i<<21|i>>>11)+s|0;t[0]=r+t[0]|0;t[1]=i+t[1]|0;t[2]=s+t[2]|0;t[3]=n+t[3]|0}function i(t){var e,r=[];for(e=0;e<64;e+=4)r[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return r}function s(t){var e,r=[];for(e=0;e<64;e+=4)r[e>>2]=t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24);return r}function n(t){var e,s,n,o,a,h,u=t.length,c=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=u;e+=64)r(c,i(t.substring(e-64,e)));t=t.substring(e-64);s=t.length;n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<s;e+=1)n[e>>2]|=t.charCodeAt(e)<<(e%4<<3);n[e>>2]|=128<<(e%4<<3);if(e>55){r(c,n);for(e=0;e<16;e+=1)n[e]=0}o=u*8;o=o.toString(16).match(/(.*?)(.{0,8})$/);a=parseInt(o[2],16);h=parseInt(o[1],16)||0;n[14]=a;n[15]=h;r(c,n);return c}function o(t){var e,i,n,o,a,h,u=t.length,c=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=u;e+=64)r(c,s(t.subarray(e-64,e)));t=e-64<u?t.subarray(e-64):new Uint8Array(0);i=t.length;n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<i;e+=1)n[e>>2]|=t[e]<<(e%4<<3);n[e>>2]|=128<<(e%4<<3);if(e>55){r(c,n);for(e=0;e<16;e+=1)n[e]=0}o=u*8;o=o.toString(16).match(/(.*?)(.{0,8})$/);a=parseInt(o[2],16);h=parseInt(o[1],16)||0;n[14]=a;n[15]=h;r(c,n);return c}function a(t){var r,i="";for(r=0;r<4;r+=1)i+=e[t>>r*8+4&15]+e[t>>r*8&15];return i}function h(t){var e;for(e=0;e<t.length;e+=1)t[e]=a(t[e]);return t.join("")}h(n("hello"))!=="5d41402abc4b2a76b9719d911017c592";typeof ArrayBuffer==="undefined"||ArrayBuffer.prototype.slice||function(){function e(t,e){t=t|0||0;return t<0?Math.max(t+e,0):Math.min(t,e)}ArrayBuffer.prototype.slice=function(r,i){var s,n,o,a,h=this.byteLength,u=e(r,h),c=h;i!==t&&(c=e(i,h));if(u>c)return new ArrayBuffer(0);s=c-u;n=new ArrayBuffer(s);o=new Uint8Array(n);a=new Uint8Array(this,u,s);o.set(a);return n}}();function u(t){/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t)));return t}function c(t,e){var r,i=t.length,s=new ArrayBuffer(i),n=new Uint8Array(s);for(r=0;r<i;r+=1)n[r]=t.charCodeAt(r);return e?n:s}function l(t){return String.fromCharCode.apply(null,new Uint8Array(t))}function f(t,e,r){var i=new Uint8Array(t.byteLength+e.byteLength);i.set(new Uint8Array(t));i.set(new Uint8Array(e),t.byteLength);return r?i:i.buffer}function d(t){var e,r=[],i=t.length;for(e=0;e<i-1;e+=2)r.push(parseInt(t.substr(e,2),16));return String.fromCharCode.apply(String,r)}function p(){this.reset()}p.prototype.append=function(t){this.appendBinary(u(t));return this};p.prototype.appendBinary=function(t){this._buff+=t;this._length+=t.length;var e,s=this._buff.length;for(e=64;e<=s;e+=64)r(this._hash,i(this._buff.substring(e-64,e)));this._buff=this._buff.substring(e-64);return this};p.prototype.end=function(t){var e,r,i=this._buff,s=i.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<s;e+=1)n[e>>2]|=i.charCodeAt(e)<<(e%4<<3);this._finish(n,s);r=h(this._hash);t&&(r=d(r));this.reset();return r};p.prototype.reset=function(){this._buff="";this._length=0;this._hash=[1732584193,-271733879,-1732584194,271733878];return this};p.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}};p.prototype.setState=function(t){this._buff=t.buff;this._length=t.length;this._hash=t.hash;return this};p.prototype.destroy=function(){delete this._hash;delete this._buff;delete this._length};p.prototype._finish=function(t,e){var i,s,n,o=e;t[o>>2]|=128<<(o%4<<3);if(o>55){r(this._hash,t);for(o=0;o<16;o+=1)t[o]=0}i=this._length*8;i=i.toString(16).match(/(.*?)(.{0,8})$/);s=parseInt(i[2],16);n=parseInt(i[1],16)||0;t[14]=s;t[15]=n;r(this._hash,t)};p.hash=function(t,e){return p.hashBinary(u(t),e)};p.hashBinary=function(t,e){var r=n(t),i=h(r);return e?d(i):i};p.ArrayBuffer=function(){this.reset()};p.ArrayBuffer.prototype.append=function(t){var e,i=f(this._buff.buffer,t,true),n=i.length;this._length+=t.byteLength;for(e=64;e<=n;e+=64)r(this._hash,s(i.subarray(e-64,e)));this._buff=e-64<n?new Uint8Array(i.buffer.slice(e-64)):new Uint8Array(0);return this};p.ArrayBuffer.prototype.end=function(t){var e,r,i=this._buff,s=i.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<s;e+=1)n[e>>2]|=i[e]<<(e%4<<3);this._finish(n,s);r=h(this._hash);t&&(r=d(r));this.reset();return r};p.ArrayBuffer.prototype.reset=function(){this._buff=new Uint8Array(0);this._length=0;this._hash=[1732584193,-271733879,-1732584194,271733878];return this};p.ArrayBuffer.prototype.getState=function(){var t=p.prototype.getState.call(this);t.buff=l(t.buff);return t};p.ArrayBuffer.prototype.setState=function(t){t.buff=c(t.buff,true);return p.prototype.setState.call(this,t)};p.ArrayBuffer.prototype.destroy=p.prototype.destroy;p.ArrayBuffer.prototype._finish=p.prototype._finish;p.ArrayBuffer.hash=function(t,e){var r=o(new Uint8Array(t)),i=h(r);return e?d(i):i};return p}))})(t);var e=t.exports;const r=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice;class FileChecksum{static create(t,e){const r=new FileChecksum(t);r.create(e)}constructor(t){this.file=t;this.chunkSize=2097152;this.chunkCount=Math.ceil(this.file.size/this.chunkSize);this.chunkIndex=0}create(t){this.callback=t;this.md5Buffer=new e.ArrayBuffer;this.fileReader=new FileReader;this.fileReader.addEventListener("load",(t=>this.fileReaderDidLoad(t)));this.fileReader.addEventListener("error",(t=>this.fileReaderDidError(t)));this.readNextChunk()}fileReaderDidLoad(t){this.md5Buffer.append(t.target.result);if(!this.readNextChunk()){const t=this.md5Buffer.end(true);const e=btoa(t);this.callback(null,e)}}fileReaderDidError(t){this.callback(`Error reading ${this.file.name}`)}readNextChunk(){if(this.chunkIndex<this.chunkCount||this.chunkIndex==0&&this.chunkCount==0){const t=this.chunkIndex*this.chunkSize;const e=Math.min(t+this.chunkSize,this.file.size);const i=r.call(this.file,t,e);this.fileReader.readAsArrayBuffer(i);this.chunkIndex++;return true}return false}}function i(t){const e=n(document.head,`meta[name="${t}"]`);if(e)return e.getAttribute("content")}function s(t,e){if(typeof t=="string"){e=t;t=document}const r=t.querySelectorAll(e);return a(r)}function n(t,e){if(typeof t=="string"){e=t;t=document}return t.querySelector(e)}function o(t,e,r={}){const{disabled:i}=t;const{bubbles:s,cancelable:n,detail:o}=r;const a=document.createEvent("Event");a.initEvent(e,s||true,n||true);a.detail=o||{};try{t.disabled=false;t.dispatchEvent(a)}finally{t.disabled=i}return a}function a(t){return Array.isArray(t)?t:Array.from?Array.from(t):[].slice.call(t)}class BlobRecord{constructor(t,e,r,s={}){this.file=t;this.attributes={filename:t.name,content_type:t.type||"application/octet-stream",byte_size:t.size,checksum:e};this.xhr=new XMLHttpRequest;this.xhr.open("POST",r,true);this.xhr.responseType="json";this.xhr.setRequestHeader("Content-Type","application/json");this.xhr.setRequestHeader("Accept","application/json");this.xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");Object.keys(s).forEach((t=>{this.xhr.setRequestHeader(t,s[t])}));const n=i("csrf-token");n!=void 0&&this.xhr.setRequestHeader("X-CSRF-Token",n);this.xhr.addEventListener("load",(t=>this.requestDidLoad(t)));this.xhr.addEventListener("error",(t=>this.requestDidError(t)))}get status(){return this.xhr.status}get response(){const{responseType:t,response:e}=this.xhr;return t=="json"?e:JSON.parse(e)}create(t){this.callback=t;this.xhr.send(JSON.stringify({blob:this.attributes}))}requestDidLoad(t){if(this.status>=200&&this.status<300){const{response:t}=this;const{direct_upload:e}=t;delete t.direct_upload;this.attributes=t;this.directUploadData=e;this.callback(null,this.toJSON())}else this.requestDidError(t)}requestDidError(t){this.callback(`Error creating Blob for "${this.file.name}". Status: ${this.status}`)}toJSON(){const t={};for(const e in this.attributes)t[e]=this.attributes[e];return t}}class BlobUpload{constructor(t){this.blob=t;this.file=t.file;const{url:e,headers:r}=t.directUploadData;this.xhr=new XMLHttpRequest;this.xhr.open("PUT",e,true);this.xhr.responseType="text";for(const t in r)this.xhr.setRequestHeader(t,r[t]);this.xhr.addEventListener("load",(t=>this.requestDidLoad(t)));this.xhr.addEventListener("error",(t=>this.requestDidError(t)))}create(t){this.callback=t;this.xhr.send(this.file.slice())}requestDidLoad(t){const{status:e,response:r}=this.xhr;e>=200&&e<300?this.callback(null,r):this.requestDidError(t)}requestDidError(t){this.callback(`Error storing "${this.file.name}". Status: ${this.xhr.status}`)}}let h=0;class DirectUpload{constructor(t,e,r,i={}){this.id=++h;this.file=t;this.url=e;this.delegate=r;this.customHeaders=i}create(t){FileChecksum.create(this.file,((e,r)=>{if(e){t(e);return}const i=new BlobRecord(this.file,r,this.url,this.customHeaders);u(this.delegate,"directUploadWillCreateBlobWithXHR",i.xhr);i.create((e=>{if(e)t(e);else{const e=new BlobUpload(i);u(this.delegate,"directUploadWillStoreFileWithXHR",e.xhr);e.create((e=>{e?t(e):t(null,i.toJSON())}))}}))}))}}function u(t,e,...r){if(t&&typeof t[e]=="function")return t[e](...r)}class DirectUploadController{constructor(t,e){this.input=t;this.file=e;this.directUpload=new DirectUpload(this.file,this.url,this);this.dispatch("initialize")}start(t){const e=document.createElement("input");e.type="hidden";e.name=this.input.name;this.input.insertAdjacentElement("beforebegin",e);this.dispatch("start");this.directUpload.create(((r,i)=>{if(r){e.parentNode.removeChild(e);this.dispatchError(r)}else e.value=i.signed_id;this.dispatch("end");t(r)}))}uploadRequestDidProgress(t){const e=t.loaded/t.total*100;e&&this.dispatch("progress",{progress:e})}get url(){return this.input.getAttribute("data-direct-upload-url")}dispatch(t,e={}){e.file=this.file;e.id=this.directUpload.id;return o(this.input,`direct-upload:${t}`,{detail:e})}dispatchError(t){const e=this.dispatch("error",{error:t});e.defaultPrevented||alert(t)}directUploadWillCreateBlobWithXHR(t){this.dispatch("before-blob-request",{xhr:t})}directUploadWillStoreFileWithXHR(t){this.dispatch("before-storage-request",{xhr:t});t.upload.addEventListener("progress",(t=>this.uploadRequestDidProgress(t)))}}const c="input[type=file][data-direct-upload-url]:not([disabled])";class DirectUploadsController{constructor(t){this.form=t;this.inputs=s(t,c).filter((t=>t.files.length))}start(t){const e=this.createDirectUploadControllers();const r=()=>{const i=e.shift();if(i)i.start((e=>{if(e){t(e);this.dispatch("end")}else r()}));else{t();this.dispatch("end")}};this.dispatch("start");r()}createDirectUploadControllers(){const t=[];this.inputs.forEach((e=>{a(e.files).forEach((r=>{const i=new DirectUploadController(e,r);t.push(i)}))}));return t}dispatch(t,e={}){return o(this.form,`direct-uploads:${t}`,{detail:e})}}const l="data-direct-uploads-processing";const f=new WeakMap;let d=false;function p(){if(!d){d=true;document.addEventListener("click",b,true);document.addEventListener("submit",y,true);document.addEventListener("ajax:before",g)}}function b(t){const e=t.target.closest("button, input");e&&e.type==="submit"&&e.form&&f.set(e.form,e)}function y(t){m(t)}function g(t){t.target.tagName=="FORM"&&m(t)}function m(t){const e=t.target;if(e.hasAttribute(l)){t.preventDefault();return}const r=new DirectUploadsController(e);const{inputs:i}=r;if(i.length){t.preventDefault();e.setAttribute(l,"");i.forEach(v);r.start((t=>{e.removeAttribute(l);t?i.forEach(_):A(e)}))}}function A(t){let e=f.get(t)||n(t,"input[type=submit], button[type=submit]");if(e){const{disabled:t}=e;e.disabled=false;e.focus();e.click();e.disabled=t}else{e=document.createElement("input");e.type="submit";e.style.display="none";t.appendChild(e);e.click();t.removeChild(e)}f.delete(t)}function v(t){t.disabled=true}function _(t){t.disabled=false}function x(){window.ActiveStorage&&p()}setTimeout(x,1);export{DirectUpload,DirectUploadController,DirectUploadsController,o as dispatchEvent,p as start};

